# Moon Logistics & Task Network - Constants Configuration
# Based on model.md formulation
# =============================================================================

# -----------------------------------------------------------------------------
# Time Parameters
# -----------------------------------------------------------------------------
time:
  delta_t: 2628000   # 1 month in seconds (365 * 24 * 3600 / 12)
  T_max: 1200         # Maximum time horizon (time steps)
  start_year: 2050   # Calendar year for t=0 (Phase I start)
  steps_per_year: 12

# -----------------------------------------------------------------------------
# Unit Conversions
# -----------------------------------------------------------------------------
units:
  # NOTE: Model mass unit is ton. Legacy *_kg keys are in ton units.
  ton_to_kg: 1
  seconds_per_day: 86400

# -----------------------------------------------------------------------------
# Network Templates (expanded to nodes/arcs in utils.expand_network_templates)
# -----------------------------------------------------------------------------
network:
  moon:
    id: "Moon"
    name: "Lunar Surface"
  harbours:
    count: 3
    earth_port_id_template: "E_port_H{h}"
    earth_port_name_template: "Galactic Harbour {h} - Earth Port"
  launch_sites:
    known:
      - id: "Launch_Agg"
        name: "Aggregate Earth Launch Site"
  arcs:
    elevator:
      lead_time_days: 7
      payload_t: 20
      cost_per_kg_2050: 20000
      enabled: ["E-only", "Mix"]
    transfer:
      lead_time_days: 5
      payload_t: 20
      cost_per_kg_2050: 40000
      enabled: ["E-only", "Mix"]
    rocket:
      lead_time_days: 5
      payload_t: 100
      cost_per_kg_2050: 100000
      enabled: ["R-only", "Mix"]
    ground:
      lead_time: 1
      payload: 1000000
      cost_per_kg_2050: 0
      enabled: ["E-only", "R-only", "Mix"]

# -----------------------------------------------------------------------------
# Resource Types (R)
# -----------------------------------------------------------------------------
resources:
  - id: "structure"
    name: "Structural Materials"
    isru_producible: true
  - id: "equipment"
    name: "Equipment/Machinery"
    isru_producible: false
  - id: "water"
    name: "Water/Volatiles"
    isru_producible: true
  - id: "fuel"
    name: "Propellants"
    isru_producible: true
  - id: "electronics"
    name: "Electronics/Control"
    isru_producible: false
  - id: "life_support"
    name: "Life Support Systems"
    isru_producible: false

# -----------------------------------------------------------------------------
# Scenario Definitions (S)
# -----------------------------------------------------------------------------
scenarios:
  - id: "E-only"
    name: "Elevator Only"
    description: "Space elevator as sole transport"
  - id: "R-only"
    name: "Rocket Only"
    description: "Rockets as sole transport"
  - id: "Mix"
    name: "Mixed"
    description: "Combined elevator and rocket"

# -----------------------------------------------------------------------------
# Scenario Parameter References (from outline/parameters.md)
# -----------------------------------------------------------------------------
scenario_parameters:
  elevator:
    climber_payload_t: 20
    transit_time_days: 7
    climber_velocity_kmh: 200
    required_avg_velocity:
      mps: 83
      kmh: 298
    power_limit_mw: 4
    material_specific_strength_gpa_cc_g:
      min: 30
      max: 40
    construction_cost_usd: 10000000000
    cost_per_kg_usd:
      initial: 500000
      mature: 100000
    stream_model:
      enabled: true
  rocket:
    falcon_heavy_payload_tli_t:
      min: 15
      max: 16
    falcon_heavy_cost_usd: 150000000
    starship_cost_per_kg_usd:
      upper: 100000
      target: 20000
    delta_v_leo_to_moon_kms: 5.9
    payload_logistic:
      L_max_t: 250
      L_ref_t: 150
      k: 0.12
      t0_year: 2050
      ref_year: 2050
    launch_rate:
      base_per_year: 3000
      annual_growth_rate: 0.05
      max_per_year: 10000
      start_year: 2050
  arc_selection:
    simplified_single_arc: false
    arc_rocket_id: "Launch_Agg_to_Moon_R"
    arc_elevator_id: "E_port_H1_to_Moon_E"

# -----------------------------------------------------------------------------
# Cost Parameters ($)
# -----------------------------------------------------------------------------
costs:
  # Elevator costs (per ton)
  elevator:
    initial: 500000     # $/ton (Phase 0)
    mature: 100000      # $/ton (Phase 1)
    fixed_per_trip: 0   # No fixed launch cost
    
  # Rocket costs
  rocket:
    falcon_heavy:
      per_kg: 10000000    # ~$150M / 15t
      fixed_per_launch: 150000000  # $150M
    starship:
      per_kg_initial: 100000
      per_kg_target: 20000
      fixed_per_launch: 2000000  # Target $2M
    cost_decay:
      base_year: 2024
      base_cost_usd_per_kg: 870600
      annual_decay_rate: 0.055
      decay_rate_monthly: 0.01
      min_cost_usd_per_kg: 20000

# -----------------------------------------------------------------------------
# Initial Capacity Parameters (at t=0)
# -----------------------------------------------------------------------------
initial_capacities:
  P_0: 0.1      # ISRU production (ton/s) -> 3150 t/y
  V_0: 0.05     # Construction/assembly (ton/s)
  H_0: 0.1      # Handling/receiving (ton/s)
  Pop_0: 0      # Population capacity (persons)
  Power_0: 5000  # Power capacity (MW) - bootstrap to avoid power deadlock
  
  # Transport capacity pools
  C_E_0: 0.00567607    # 电梯固定运力 (ton/s) = 179000 t/year

# -----------------------------------------------------------------------------
# Learning Curve Parameters
# -----------------------------------------------------------------------------
learning:
  # Cost reduction factor per doubling of cumulative throughput
  elevator_rate: 0.85   # 15% reduction per doubling
  rocket_rate: 0.90     # 10% reduction per doubling (reuse)
  isru_rate: 0.80       # 20% reduction per doubling

# -----------------------------------------------------------------------------
# ISRU Production Parameters
# -----------------------------------------------------------------------------
isru:
  # Efficiency ratios (output/input)
  water_extraction_rate: 0.03       # kg H2O per kg regolith
  oxygen_from_ilmenite: 0.045       # kg O2 per kg ilmenite
  metal_from_regolith: 0.01         # kg metal per kg regolith
  
  # Energy requirements (kWh/ton product)
  water_energy: 50000
  oxygen_energy: 100000
  metal_energy: 500000

# -----------------------------------------------------------------------------
# Task Network (AON/RCPSP) Default Parameters
# Note: Actual task definitions in settings.py
# -----------------------------------------------------------------------------
task_defaults:
  min_duration: 1               # Minimum task duration (months)
  max_concurrent_tasks: 5       # Parallel task limit
  installation_delay: 1         # d_i: delay from completion to capability (months)

# -----------------------------------------------------------------------------
# Task/Theme-Oriented Parameter Summary (from outline/model.md §5)
# -----------------------------------------------------------------------------
parameter_summary:
  materials:
    bom:
      total_demand_tons: 100000000
      tiers:
        - id: "tier_1"
          name: "precision_seed"
          class: 1
          share_initial: 0.15
          resources: ["electronics"]
        - id: "tier_2"
          name: "industrial_core"
          class: 2
          share_initial: 0.35
          resources: ["equipment", "life_support"]
        - id: "tier_3"
          name: "basic_resources"
          class: 3
          share_initial: 0.5
          resources: ["structure", "water", "fuel"]
  transport:
    capacities:
      elevator_capacity_fixed_tpy: 179000  # 固定 179000 t/year
  colony:
    target:
      population: 100000
    requirements:
      water_per_capita_per_month: 0.5  # tons/person/month (assumption: 16-17 kg/day? High but simple)

# -----------------------------------------------------------------------------
# Implementation Details (from outline/assumptions/implementation_details.md)
# -----------------------------------------------------------------------------
implementation_details:
  growth_model:
    initial_state:
      P_0: 0.1          # Production (t/y) approx 3500 t/y
      H_ratio: 1.5      # Handling capacity buffer ratio
      
    phases:
      # P(t) = P(t-1) + beta * Inflow_Tier1
      bootstrapping:
        beta_equipment_to_capacity: 50.0  # 1 ton Tier1 -> 50 t/y capacity (High leverage)
        
      # P(t) = P(t-1) + eta * delta_Growth - depreciation
      replication:
        eta_isru_efficiency: 0.90
        alpha_replication_rate: 0.35      # 35% growth per year 
        
      # P(t) capped by K
      saturation:
        carrying_capacity_tpy: 50000000   # 50M t/y
        decay_rate_phi: 0.05              # 5% annual depreciation

  logistics:
    handling_capacity:
      excavator_efficiency_t_per_hour_per_ton: 10
      handling_t_per_month_per_ton_excavator: 6000
    time_discretization:
      threshold_days: 15
  materials:
    bom_mapping:
      total_demand_tons: 100000000
      categories:
        - id: "infrastructure"
          share: 0.40
          source_policy: "isru_only"
        - id: "structures"
          share: 0.30
          source_policy: "earth_then_isru"
          earth_share_initial: 0.50
          isru_share_final: 0.90
        - id: "consumables"
          share: 0.20
          source_policy: "isru_only"
        - id: "high_tech"
          share: 0.10
          source_policy: "earth_dominant"
          earth_share: 0.90
          isru_share: 0.10

# -----------------------------------------------------------------------------
# Optimization Bounds & Variable Domains
# -----------------------------------------------------------------------------
optimization:
  big_m: 1000000000
  integer_vars:
    - "u"
    - "u_done"
    - "N_rate"

# -----------------------------------------------------------------------------
# Objective Function Weights
# -----------------------------------------------------------------------------
objective:
  w_C: 1.0      # Cost weight
  w_T: 10000      # Time weight ($/month equivalent) 
  
# -----------------------------------------------------------------------------
# Solver Settings
# -----------------------------------------------------------------------------
solver:
  time_limit: 3600    # seconds
  gap_tolerance: 0.10 # 5% MIP gap
  threads: 8
  horizon_step_months: 24
  horizon_max_attempts: 0
  v0_scale_factor: 10.0
  v0_adjust_attempts: 4

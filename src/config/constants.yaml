# Moon Logistics & Task Network - Constants Configuration
# Based on model.md formulation
# =============================================================================

# -----------------------------------------------------------------------------
# Time Parameters
# -----------------------------------------------------------------------------
time:
  delta_t: 2628000   # 1 month in seconds (365 * 24 * 3600 / 12)
  T_max: 2400         # Maximum time horizon (time steps)
  start_year: 2050   # Calendar year for t=0 (Phase I start)
  steps_per_year: 12

# -----------------------------------------------------------------------------
# Unit Conversions
# -----------------------------------------------------------------------------
units:
  # NOTE: Model mass unit is ton. Legacy *_kg keys are in ton units.
  ton_to_kg: 1
  seconds_per_day: 86400

# -----------------------------------------------------------------------------
# Network
# -----------------------------------------------------------------------------
network:
  moon:
    id: "Moon"
    name: "Lunar Surface"
  harbours:
    id: "E_port_Agg"
    name: "Aggregate Galactic Harbour"
  launch_sites:
    id: "Launch_Agg"
    name: "Aggregate Earth Launch Site"
  arcs:
    elevator:
      lead_time_days: 16
      payload_t: null # Will be calculated from scenario_parameters capacity (179000 t/y)
      cost_per_kg_2050: 500000 # Initial cost from scenario_parameters ($500/kg -> $500k/ton)
      enabled: ["E-only", "Mix"]
    rocket:
      lead_time_days: 4
      payload_t: 150 # L_ref_t from scenario_parameters
      cost_per_kg_2050: 88900 # $88.90/kg * 1000 (scenario base_cost)
      enabled: ["R-only", "Mix"]

# -----------------------------------------------------------------------------
# Resource Types
# -----------------------------------------------------------------------------
resources:
  - id: "structure"
    name: "Structural Materials"
    isru_producible: true
  - id: "equipment"
    name: "Equipment/Machinery"
    isru_producible: true
  - id: "water"
    name: "Water/Volatiles"
    isru_producible: true
  - id: "fuel"
    name: "Propellants"
    isru_producible: true
  - id: "electronics"
    name: "Electronics/Control"
    isru_producible: false
  - id: "life_support"
    name: "Life Support Systems"
    isru_producible: false

# -----------------------------------------------------------------------------
# Scenario Definitions (S)
# -----------------------------------------------------------------------------
scenarios:
  - id: "E-only"
    name: "Elevator Only"
    description: "Space elevator as sole transport"
  - id: "R-only"
    name: "Rocket Only"
    description: "Rockets as sole transport"
  - id: "Mix"
    name: "Mixed"
    description: "Combined elevator and rocket"

# -----------------------------------------------------------------------------
# Scenario Parameter References (from outline/parameters.md)
# -----------------------------------------------------------------------------
scenario_parameters:
  elevator:
    # Capacity: Fixed capacity
    capacity_fixed:
      capacity_tpy: 179000  # Reduced: 50k t/y (~4k/month) - makes elevator a scarce resource
      
    # Cost: Exponential decay model
    # Formula: C(t) = (C_start - C_min) * exp(-lambda * t) + C_min
    cost_decay:
      base_year: 2050
      initial_cost_usd_per_kg: 50   # Initial cost at 2050
      min_cost_usd_per_kg: 5        # Floor cost after maturity
      decay_rate_monthly: 0.005     # Monthly decay rate (λ ≈ 0.06/yr)
      
  rocket:
    payload_logistic:
      L_max_t: 250
      L_ref_t: 150
      k: 0.12
      t0_year: 2050
      ref_year: 2050
    launch_rate:
      # Logistic Growth Model: L(t) = K / (1 + A * exp(-r * (t - t0)))
      # Fitted to historical data (2000-2024)
      K: 1500        # Carrying capacity (max launches/year)
      A: 10.00       # Initial scaling factor
      r: 0.0970      # Growth rate
      t0: 2020       # Fitted inflection year
    cost_decay:
      # Exponential Decay: C(t) = (C_start - C_min) * exp(-lambda * t) + C_min
      # Fitted to 2005-2024 history ($25k -> $1.5k). Base Year t=0 is 2050.
      base_year: 2050
      base_cost_usd_per_kg: 110.68   # Projected cost at 2050
      decay_rate_monthly: 0.014488  # Annual: 0.1800 -> Monthly: 0.015
      min_cost_usd_per_kg: 100.0    # Floor cost

# -----------------------------------------------------------------------------
# Initial Capacity Parameters (at t=0)
# -----------------------------------------------------------------------------
initial_capacities:
  H_0: 4.75e-9     # Handling/receiving (ton/s) -> 1.5 * P_0 (0.1 t/y)
  Pop_0: 0      # Population capacity (persons)
  Power_0: 0.1  # Power capacity (MW) - bootstrap to avoid power deadlock

# -----------------------------------------------------------------------------
# Task/Theme-Oriented Parameter Summary
# -----------------------------------------------------------------------------
parameter_summary:
  materials:
    bom:
      total_demand_tons: 100000000
      tiers:
        - id: "tier_1"
          name: "precision_seed"
          class: 1
          share_initial: 0.15
          resources: ["electronics"]
        - id: "tier_2"
          name: "industrial_core"
          class: 2
          share_initial: 0.35
          resources: ["equipment", "life_support"]
        - id: "tier_3"
          name: "basic_resources"
          class: 3
          share_initial: 0.5
          resources: ["structure", "water", "fuel"]
  colony:
    target:
      population: 100000
      deadline_year: 2150
    requirements:
      water_per_capita_per_month: 0.5  # tons/person/month (assumption: 16-17 kg/day? High but simple)

# -----------------------------------------------------------------------------
# Implementation Details
# -----------------------------------------------------------------------------
implementation_details:
  growth_model:
    initial_state:
      P_0: 0.1          # Production (t/y) - pilot scale startup
      H_ratio: 1.5      # Handling capacity buffer ratio
    growth_bom:
      structure: 0.7
      equipment: 0.2
      electronics: 0.1
      
    phases:
      # P(t) = P(t-1) + beta * Inflow_Tier1
      bootstrapping:
        beta_equipment_to_capacity: 10.0  # 1 ton Tier1 -> 10 t/y capacity (Realistic leverage)
        
      # P(t) = P(t-1) + eta * delta_Growth - depreciation
      replication:
        alpha_replication_rate: 0.35      # 35% growth per year 
        
      # P(t) capped by K
      saturation:
        carrying_capacity_tpy: 50000000   # 50M t/y
        decay_rate_phi: 0.05              # 5% annual depreciation

  logistics:
    time_discretization:
      threshold_days: 8

# -----------------------------------------------------------------------------
# Optimization Bounds & Variable Domains
# -----------------------------------------------------------------------------
optimization:
  big_m: 1000000000
  integer_vars:
    - "u"
    - "u_done"
    - "N_rate"

# -----------------------------------------------------------------------------
# Objective Function Weights
# -----------------------------------------------------------------------------
objective:
  w_C: 1.0      # Cost weight
  w_T: 1.0    # Time weight - Increased to balance $100B+ cost vs Ton-Months (Order of 1e11 vs 1e7)
  
# -----------------------------------------------------------------------------
# Risk / Stochastic Parameters (Task 2)
# -----------------------------------------------------------------------------
risk:
  enabled: false  # Controlled by --risk flag at runtime
  monte_carlo_runs: 1000
  elevator:
    # Efficiency factor eta ~ Beta(alpha, beta), mean = alpha/(alpha+beta) ≈ 0.85
    eta_alpha: 17.0
    eta_beta: 3.0
  rocket:
    # Each launch is Bernoulli(success_rate)
    success_rate: 0.985

# -----------------------------------------------------------------------------
# Solver Settings
# -----------------------------------------------------------------------------
solver:
  time_limit: 3600    # seconds
  gap_tolerance: 0.05 # 5% MIP gap
  threads: 8
  horizon_step_months: 12
  horizon_max_attempts: 0
  v0_scale_factor: 10.0
  v0_adjust_attempts: 4

# -----------------------------------------------------------------------------
# Water Logistics Parameters (Model III / Task 3)
# -----------------------------------------------------------------------------
water:
  population_target: 100000           # N (persons)
  t_inhabit_year: 2076                # Year humans move in (post-construction)
  
  # Inhabitation Gate Threshold
  W_gate_tons: 500000                 # Total required before move-in
  W_eco_tons: 400000                  # Ecological charging (soil hydration, biospheres)
  W_buf_tons: 100000                  # 3-month strategic safety buffer
  
  # Per-capita demand rates (kg/person/day)
  demand:
    w_dom_kg_per_cap_day: 20          # Domestic (drinking, sanitation, hygiene)
    w_ag_kg_per_cap_day: 100           # Agricultural (irrigation, evapotranspiration)
    kappa_t_water_per_t_product: 0.1  # Industrial water intensity (ton-water/ton-product)
  
  # Recycling efficiencies
  recycling:
    eta_bio: 0.96                     # Biological ECLSS recycling (domestic + ag)
    eta_ind: 0.95                     # Industrial closed-loop recycling
    lambda_leakage_annual: 0.001      # 0.1% annual structural leakage rate
  
  # ISRU Configuration
  isru:
    enabled: true
    q_L_capacity_tpy: 50000           # Lunar polar ice extraction rate (tons/year)
    F_ISRU_usd: 2.0e10                 # Fixed ISRU deployment cost ($20 Billion)

# -----------------------------------------------------------------------------
# Environmental Impact Parameters (Model IV / Task 4)
# -----------------------------------------------------------------------------
environment:
  # Emission intensity vector for rockets (kg pollutant per ton payload)
  rocket_emissions:
    e_CO2: 3100.0      # kg CO2 per ton payload (kerosene-LOX, ~3 kg/kg propellant)
    e_BC: 0.6          # kg black carbon per ton payload (stratospheric soot)
    e_Al2O3: 15.0      # kg alumina per ton payload (solid boosters)
    e_NOx: 2.5         # kg NOx per ton payload

  # Stratospheric sensitivity weights ($ per kg of pollutant)
  stratospheric_weights:
    w_CO2: 0.05        # $/kg CO2e (low, surface equivalent)
    w_BC: 200.0        # $/kg BC (Increased to create visible initial debt spike)
    w_Al2O3: 25.0      # $/kg alumina (Balanced investment cost)
    w_NOx: 50.0        # $/kg NOx (ozone catalytic cycle)

  # Elevator emissions (near-zero operational, grid-dependent)
  elevator_emissions:
    CI_grid_kg_CO2_per_kWh: 0.2    # Tuned: Cleaner grid to show initial advantage finding
    energy_per_ton_kWh: 2500.0     # Tuned: Moderate energy cost

  # Lunar disturbance coefficients (environmental shadow price)
  moon_disturbance:
    epsilon_reg: 50.0       # $/ton (Increased 100x to show significant local impact)
    epsilon_sens: 1000.0    # $/ton (sensitive zone penalty)
    sens_fraction: 0.05     # 5% of ISRU in sensitive zones

  # Conservative baseline parameters (for counterfactual comparison)
  conservative_baseline:
    bootstrap_delay_years: 10.0   # Increased: 10-year delay without heavy machinery
    capacity_growth_penalty: 0.1  # Reduced: 10% growth rate (struggling)
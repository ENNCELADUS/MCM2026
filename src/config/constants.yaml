# =============================================================================
# Moon Logistics & Task Network - Constants Configuration
# Based on model.md formulation
# =============================================================================

# -----------------------------------------------------------------------------
# Time Parameters
# -----------------------------------------------------------------------------
time:
  delta_t: 2592000  # 1 month in seconds (30 * 24 * 3600)
  T_max: 600        # Maximum time horizon (months, 50 years, 2050-2100)
  start_year: 2050  # Calendar year for t=0 (Phase I start)
  steps_per_year: 12

# -----------------------------------------------------------------------------
# Unit Conversions
# -----------------------------------------------------------------------------
units:
  ton_to_kg: 1000
  seconds_per_day: 86400

# -----------------------------------------------------------------------------
# Network Nodes (N)
# -----------------------------------------------------------------------------
nodes:
  - id: "E_agg"
    name: "Earth Aggregation"
    type: "earth"
  - id: "E_port"
    name: "Earth Launch Port"
    type: "earth"
  - id: "Apex"
    name: "GEO Apex Station"
    type: "transit"
  - id: "Moon"
    name: "Lunar Surface"
    type: "moon"

# -----------------------------------------------------------------------------
# Logistics Arcs (A)
# format: {from, to, id, type, lead_time, payload, enabled}
# lead_time and payload are in months and kg, respectively.
# -----------------------------------------------------------------------------
arcs:
  # Elevator segments
  - id: "E_port_to_Apex"
    from: "E_port"
    to: "Apex"
    type: "elevator"
    lead_time_days: 7       # ~1 week to GEO
    payload_t: 20           # 20t climber
    cost_per_kg_2050: 20    # Target operational cost
    enabled: ["E-only", "Mix"]

  - id: "Apex_to_Moon"
    from: "Apex"
    to: "Moon"
    type: "transfer"
    lead_time_days: 5       # Transfer + LOI + Landing
    payload_t: 20           # Matches climber payload
    cost_per_kg_2050: 40    # $60 total (20 lift + 40 transfer/landing)
    enabled: ["E-only", "Mix"]

  # Rocket segments
  - id: "E_port_to_Moon_R"
    from: "E_port"
    to: "Moon"
    type: "rocket"
    lead_time_days: 5       # Direct TLI
    payload_t: 100          # Starship class
    cost_per_kg_2050: 100   # 2050 Target ($100/kg)
    enabled: ["R-only", "Mix"]

  # Ground transport (Earth)
  - id: "E_agg_to_E_port"
    from: "E_agg"
    to: "E_port"
    type: "ground"
    lead_time: 1
    payload: 1000000
    cost_per_kg_2050: 0
    enabled: ["E-only", "R-only", "Mix"]

# -----------------------------------------------------------------------------
# Resource Types (R)
# -----------------------------------------------------------------------------
resources:
  - id: "structure"
    name: "Structural Materials"
    isru_producible: true
  - id: "equipment"
    name: "Equipment/Machinery"
    isru_producible: false
  - id: "water"
    name: "Water/Volatiles"
    isru_producible: true
  - id: "fuel"
    name: "Propellants"
    isru_producible: true
  - id: "electronics"
    name: "Electronics/Control"
    isru_producible: false
  - id: "life_support"
    name: "Life Support Systems"
    isru_producible: false

# -----------------------------------------------------------------------------
# Scenario Definitions (S)
# -----------------------------------------------------------------------------
scenarios:
  - id: "E-only"
    name: "Elevator Only"
    description: "Space elevator as sole transport"
  - id: "R-only"
    name: "Rocket Only"
    description: "Rockets as sole transport"
  - id: "Mix"
    name: "Mixed"
    description: "Combined elevator and rocket"

# -----------------------------------------------------------------------------
# Scenario Parameter References (from outline/parameters.md)
# -----------------------------------------------------------------------------
scenario_parameters:
  elevator:
    climber_payload_t: 20
    annual_throughput_tpy:
      initial: 5100
      mature: 30000
      six_tethers: 170000
    annual_throughput_kg_per_s:
      initial: 0.1617199391
      mature: 0.9512937595
      six_tethers: 5.3906646372
    transit_time_days: 7
    climber_velocity_kmh: 200
    required_avg_velocity:
      mps: 83
      kmh: 298
    power_limit_mw: 4
    material_specific_strength_gpa_cc_g:
      min: 30
      max: 40
    construction_cost_usd: 10000000000
    cost_per_kg_usd:
      initial: 500
      mature: 100
  rocket:
    falcon_heavy_payload_tli_t:
      min: 15
      max: 16
    falcon_heavy_cost_usd: 150000000
    starship_cost_per_kg_usd:
      upper: 100
      target: 20
    delta_v_leo_to_moon_kms: 5.9

# -----------------------------------------------------------------------------
# Cost Parameters ($)
# -----------------------------------------------------------------------------
costs:
  # Elevator costs (per kg)
  elevator:
    initial: 500        # $/kg (Phase 0)
    mature: 100         # $/kg (Phase 1)
    fixed_per_trip: 0   # No fixed launch cost
    
  # Rocket costs
  rocket:
    falcon_heavy:
      per_kg: 10000       # ~$150M / 15t
      fixed_per_launch: 150000000  # $150M
    starship:
      per_kg_initial: 100
      per_kg_target: 20
      fixed_per_launch: 2000000  # Target $2M

# -----------------------------------------------------------------------------
# Initial Capacity Parameters (at t=0)
# -----------------------------------------------------------------------------
initial_capacities:
  P_0: 0.0      # ISRU production (kg/s)
  V_0: 0.0001   # Construction/assembly (kg/s) - epsilon > 0
  H_0: 0.001    # Handling/receiving (kg/s) - minimal initial
  Pop_0: 0      # Population capacity (persons)
  Power_0: 0.0  # Power capacity (MW)
  
  # Transport capacity pools
  C_R_0: 0.1617 # Rocket capacity pool (kg/s) - 5000 t/yr baseline
  C_E_0: 0.2    # Elevator capacity pool (kg/s) - ~500t/month

# -----------------------------------------------------------------------------
# Learning Curve Parameters
# -----------------------------------------------------------------------------
learning:
  # Cost reduction factor per doubling of cumulative throughput
  elevator_rate: 0.85   # 15% reduction per doubling
  rocket_rate: 0.90     # 10% reduction per doubling (reuse)
  isru_rate: 0.80       # 20% reduction per doubling

# -----------------------------------------------------------------------------
# ISRU Production Parameters
# -----------------------------------------------------------------------------
isru:
  # Efficiency ratios (output/input)
  water_extraction_rate: 0.03       # kg H2O per kg regolith
  oxygen_from_ilmenite: 0.045       # kg O2 per kg ilmenite
  metal_from_regolith: 0.01         # kg metal per kg regolith
  
  # Energy requirements (kWh/kg product)
  water_energy: 50
  oxygen_energy: 100
  metal_energy: 500

# -----------------------------------------------------------------------------
# Task Network (AON/RCPSP) Default Parameters
# Note: Actual task definitions in settings.py
# -----------------------------------------------------------------------------
task_defaults:
  min_duration: 1               # Minimum task duration (months)
  max_concurrent_tasks: 5       # Parallel task limit
  installation_delay: 1         # d_i: delay from completion to capability (months)

# -----------------------------------------------------------------------------
# Task / Environmental Parameters (from outline/parameters.md)
# -----------------------------------------------------------------------------
# -----------------------------------------------------------------------------
# Parameter Summary & Constraint Supplements (from outline/model.md ยง5)
# -----------------------------------------------------------------------------
parameter_summary:
  bom:
    total_demand_tons: 100000000
    tiers:
      - id: "tier_1"
        name: "precision_seed"
        class: 1
        chi:
          min: 0.99
          max: 1.0
        share_initial: 0.15
        share_final_max: 0.01
        source_policy: "earth_only"
        resources: ["electronics"]
        examples: ["chips", "sensors"]
      - id: "tier_2"
        name: "industrial_core"
        class: 2
        chi:
          min: 0.3
          max: 0.7
        share_initial: 0.35
        share_final: 0.04
        source_policy: "mixed"
        resources: ["equipment", "life_support"]
        examples: ["motors", "tools"]
      - id: "tier_3"
        name: "basic_resources"
        class: 3
        chi:
          min: 0.0
          max: 0.1
        share_initial: 0.5
        share_final_min: 0.95
        source_policy: "isru_only"
        resources: ["structure", "water", "fuel"]
        examples: ["structure", "oxygen", "water"]
  logistics:
    rocket_capacity:
      growth_model: "logistic"
      year_2050_single_launch_capacity_mt:
        min: 100
        max: 150
      max_capacity_mt: 250
    launch_cost_model: "wrights_law_plus_transcost"
    year_2050_cost_usd_per_kg:
      min: 100
      max: 200
    elevator_capacity_upper_tpy: 179000
    environmental_constraint:
      index: "WEI"
      black_carbon_weight: 500
  isru_bootstrapping:
    equation: "P_dot = eta * phi * P + beta * T1"
    eta:
      min: 0.90
      max: 0.98
    phi:
      initial:
        min: 0.6
        max: 0.8
      mature: 0.1
    alpha_per_year:
      min: 0.2
      max: 0.4
    beta:
      min: 10
      max: 100
    gamma:
      note: "class2_to_class3"
      magnitude: ">>1"
  scenarios:
    pivot_condition: "local_energy_cost < transport_cost"
    timeline:
      - phase: "Phase I"
        years:
          start: 2050
          end: 2060
        description: "seed stage (T1,T2 dependent)"
      - phase: "Phase II"
        years:
          start: 2060
          end: 2080
        description: "expansion stage (P2,P3 exponential growth)"
      - phase: "Phase III"
        years:
          start: 2080
        description: "mature self-sufficiency (T -> 0)"

# -----------------------------------------------------------------------------
# Implementation Details (from outline/assumptions/implementation_details.md)
# -----------------------------------------------------------------------------
implementation_details:
  wbs_tasks:
    - id: "T01"
      name: "Site_Survey_Prep"
      predecessors: []
      earth_mass_t: 5
      regolith_mass_t: 500
      duration_months: 3
      unlocks:
        power_mw: 0
        handling_t_per_month: 0
        production_t_per_year: 0
        population: 0
    - id: "T02"
      name: "Power_Gen_Phase1"
      predecessors: ["T01"]
      earth_mass_t: 60
      regolith_mass_t: 200
      duration_months: 6
      unlocks:
        power_mw: 1
        handling_t_per_month: 0
        production_t_per_year: 0
        population: 0
    - id: "T03"
      name: "Landing_Pad_V1"
      predecessors: ["T01"]
      earth_mass_t: 10
      regolith_mass_t: 2000
      duration_months: 4
      unlocks:
        power_mw: 0
        handling_t_per_month: 50
        production_t_per_year: 0
        population: 0
    - id: "T04"
      name: "ISRU_Pilot_Plant"
      predecessors: ["T02", "T03"]
      earth_mass_t: 20
      regolith_mass_t: 100
      duration_months: 6
      unlocks:
        power_mw: 0
        handling_t_per_month: 0
        production_t_per_year: 100
        population: 0
    - id: "T05"
      name: "Habitat_Module_A"
      predecessors: ["T04"]
      earth_mass_t: 25
      regolith_mass_t: 5000
      duration_months: 3
      unlocks:
        power_mw: 0
        handling_t_per_month: 0
        production_t_per_year: 0
        population: 20
    - id: "T06"
      name: "ISRU_Industrial"
      predecessors: ["T04"]
      earth_mass_t: 150
      regolith_mass_t: 1000
      duration_months: 12
      unlocks:
        power_mw: 0
        handling_t_per_month: 0
        production_t_per_year: 5000
        population: 0
    - id: "T07"
      name: "Power_Gen_Phase2"
      predecessors: ["T06"]
      earth_mass_t: 2000
      regolith_mass_t: 5000
      duration_months: 24
      unlocks:
        power_mw: 100
        handling_t_per_month: 0
        production_t_per_year: 0
        population: 0
    - id: "T08"
      name: "City_Block_Beta"
      predecessors: ["T06", "T07"]
      earth_mass_t: 500
      regolith_mass_t: 100000
      duration_months: 0
      unlocks:
        power_mw: 0
        handling_t_per_month: 0
        production_t_per_year: 0
        population: 1000

  handling_capacity:
    excavator_efficiency_t_per_hour_per_ton: 10
    handling_t_per_month_per_ton_excavator: 6000

  isru_yields:
    regolith_to_oxygen: 0.40
    regolith_to_silicon: 0.20
    regolith_to_aluminum: 0.10
    regolith_to_slag: 0.30
    tier3_combined_yield: 0.50
    tier1_2_late_stage_yield:
      min: 0.05
      max: 0.10

  bom_mapping:
    total_demand_tons: 100000000
    categories:
      - id: "infrastructure"
        share: 0.40
        source_policy: "isru_only"
        notes: "radiation shielding, landing pads, roads"
      - id: "structures"
        share: 0.30
        source_policy: "earth_then_isru"
        earth_share_initial: 0.50
        isru_share_final: 0.90
      - id: "consumables"
        share: 0.20
        source_policy: "isru_only"
      - id: "high_tech"
        share: 0.10
        source_policy: "earth_dominant"
        earth_share: 0.90
        isru_share: 0.10

  linearization_guidance:
    total_mass_equation: "M_total = sum W_i + sum M_{i,r}"
    bottleneck_note: "Tier1/2 transport is primary bottleneck"

  additional_parameters:
    time_discretization:
      steps_per_month: 1
      threshold_days: 15
      arrival_rule: "lead_lt_threshold_same_month_else_next"
    arc_selection:
      simplified_single_arc: false
      arc_rocket_id: "E_port_to_Moon_R"
      arc_elevator_id: "E_port_to_Apex"
    elevator_stream_model:
      enabled: true
      constraint: "sum_r x_elev[r,t] <= C_E(t) * delta_t"
    rocket_capacity_growth:
      baseline_tpy: 5000
      annual_growth_rate: 0.08
      formula: "C_R(t) = baseline * (1 + r)^(t/12)"
    wrights_law_cost:
      c_start_usd_per_kg: 200
      c_min_usd_per_kg: 20
      lambda_per_month: 0.01
      formula: "Cost(t) = (c_start - c_min) * exp(-lambda * t) + c_min"
    isru_bootstrapping:
      seed_input_source: "task_earth_mass"
      mode: "stepwise_task_unlocks"
    task_duration:
      fixed_setup_time: true
      note: "duration_months in WBS"
    handling_capacity:
      tied_to_tasks: true
      note: "increments from WBS unlocks"
    inventory_policy:
      unlimited_prepositioning: true
      note: "no upper bound on storage"
    energy_transport_pivot:
      local_energy_cost_usd_per_kwh: 0.10
      energy_intensity_kwh_per_kg: 500
      local_cost_per_kg_formula: "local_energy_cost * energy_intensity"
      pivot_condition: "transport_cost < local_cost"

# -----------------------------------------------------------------------------
# Optimization Bounds & Variable Domains
# -----------------------------------------------------------------------------
optimization:
  big_m: 1000000000
  integer_vars:
    - "u"
    - "y"

# -----------------------------------------------------------------------------
# Objective Function Weights
# -----------------------------------------------------------------------------
objective:
  w_C: 1.0      # Cost weight
  w_T: 1.0e8    # Time weight ($/month equivalent)

# -----------------------------------------------------------------------------
# Solver Settings
# -----------------------------------------------------------------------------
solver:
  time_limit: 3600    # seconds
  gap_tolerance: 0.01 # 1% MIP gap
  threads: 4
  horizon_step_months: 12
  horizon_max_attempts: 0
  v0_scale_factor: 10.0
  v0_adjust_attempts: 4
